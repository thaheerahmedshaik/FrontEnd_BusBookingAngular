<div class="container">
  <div class="search-info">
    <div>
      <div class="route">{{from}} → {{to}}</div>
      <div class="date">Date: {{date}}</div>
    </div>
    <a class="change-search" >Change Search</a>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Loading buses...</p>
  </div>

  <!-- No buses -->
  <div *ngIf="!loading && buses.length === 0" class="no-buses">
    <i class="fas fa-exclamation-circle"></i>
    <p>No buses found for {{from}} → {{to}}.</p>
  </div>

  <!-- Buses List -->
  <div *ngIf="!loading && buses.length > 0" class="buses-list">
    <div *ngFor="let bus of buses" class="bus-card">
      <div class="bus-header">
        <div class="bus-name">{{bus.busName}}</div>
        <div class="bus-timings">
          <span>{{bus.departureTime}}</span>
          <i class="fas fa-arrow-right"></i>
          <span>{{bus.arrivalTime}}</span>
        </div>
      </div>
      <div class="bus-details">
        <div class="bus-info">
          <div class="info-item">
            <i class="fas fa-road"></i>
            <span>Duration: {{bus.duration}}</span>
          </div>
          <div class="info-item">
            <i class="fas fa-chair"></i>
            <span>Seat Type: {{bus.seatType}}</span>
          </div>
          <div class="info-item">
            <i class="fas fa-star"></i>
            <span>Rating: <strong>{{bus.rating}}/5</strong> ({{bus.reviews}} Reviews)</span>
          </div>
          <div class="info-item">
            <i class="fas fa-bolt"></i>
            <span>Amenities: {{bus.amenities}}</span>
          </div>
        </div>
        <div class="bus-price">
          <div class="price">₹{{bus.price}}</div>
          <div class="price-text">per seat</div>
          <div class="seats-available">{{bus.availableSeats}} seats available</div>
        </div>
        <div class="bus-actions">
          <button class="view-seats-btn" (click)="openSeatSelection(bus)">View Seats</button>
          <div class="rating">
            <i class="fas fa-star"></i>
            <span>{{bus.rating}}/5</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seat Selection Modal -->
  <div *ngIf="showSeatSelectionModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Select Seats - {{selectedBus?.busName}}</div>
        <button class="close-modal" (click)="closeSeatSelection()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="seat-layout">
          <div class="bus-representation"></div>
          <div class="seats-container">
              <!-- LOWER DECK -->
      <h3 class="deck-title">Lower Deck</h3>
      <div class="seats-container">
        <div *ngFor="let seat of seats | seatFilter:'Lower'"
             class="seat"
             [class.available]="seat.available"
             [class.unavailable]="!seat.available"
             [class.selected]="isSeatSelected(seat)"
             [class.sleeper]="seat.type === 'Sleeper'"
             [class.seater]="seat.type === 'Seater'"
             (click)="toggleSeatSelection(seat)">
          {{seat.number}}
        </div>
      </div>

      <!-- UPPER DECK -->
      <h3 class="deck-title">Upper Deck</h3>
      <div class="seats-container">
        <div *ngFor="let seat of seats | seatFilter:'Upper'"
             class="seat"
             [class.available]="seat.available"
             [class.unavailable]="!seat.available"
             [class.selected]="isSeatSelected(seat)"
             [class.sleeper]="seat.type === 'Sleeper'"
             [class.seater]="seat.type === 'Seater'"
             (click)="toggleSeatSelection(seat)">
          {{seat.number}}
        </div>
      </div>
          </div>

          <!-- Seat Legend -->
          <div class="seat-info">
            <div class="seat-info-item">
              <div class="seat-color" style="background-color: #e8f5e9; border: 2px solid #4caf50;"></div>
              <span>Available</span>
            </div>
            <div class="seat-info-item">
              <div class="seat-color" style="background-color: #4caf50;"></div>
              <span>Selected</span>
            </div>
            <div class="seat-info-item">
              <div class="seat-color" style="background-color: #ebf6ff; border: 2px solid #f44336;"></div>
              <span>Booked</span>
            </div>
          </div>
        </div>

        <!-- Selected Seats -->
        <div class="selected-seats">
          <div class="selected-seats-title">
            Selected Seats: <span>{{getSelectedSeatsList()}}</span>
          </div>
        </div>

        <!-- Boarding / Dropping -->
        <div class="points-selection">
          <div>
            <label>Boarding Point:</label>
            <select class="point-select" [(ngModel)]="selectedBoardingPoint">
              <option *ngFor="let point of boardingPoints" [value]="point.name">
                {{point.name}} ({{point.time}})
              </option>
            </select>
          </div>
          <div>
            <label>Dropping Point:</label>
            <select class="point-select" [(ngModel)]="selectedDroppingPoint">
              <option *ngFor="let point of droppingPoints" [value]="point.name">
                {{point.name}} ({{point.time}})
              </option>
            </select>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="total-price">Total: ₹{{totalPrice}}</div>
        <button class="proceed-btn" (click)="proceedToPayment()">Proceed to Book</button>
      </div>
    </div>
  </div>
</div>
